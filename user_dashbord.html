<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Citizen Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
body {
     font-family: 'Inter', sans-serif;
    /*background: url('https://media.assettype.com/tnm/import/sites/all/var/www/images/SacredTrees-Photo-5.jpg?w=640&auto=format,compress') no-repeat center center fixed;
    background-size: cover; */
    color: #065f46; 
    min-height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
}

body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(252, 252, 252, 0.211); 
    z-index: -1;
}

/* ‚úÖ Fix: only active tab-content shows */
.user-tab-content {
    display: none;
}
.user-tab-content.active {
    display: block;
}

.tab-btn.active {
    border-color: #22c55e; 
    color: #22c55e;
}
.tab-btn {
    transition: all 0.2s ease;
}
.tab-btn:hover {
    border-color: #4ade80;
    color: #16a34a;
}

.map-pin {
    position: absolute;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid rgb(171, 112, 112);
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: transform 0.2s;
}
.map-pin:hover {
    transform: translate(-50%, -50%) scale(1.5);
}

.bg-white {
    background-color: #ffffff !important;
    border-radius: 1.5rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}
.bg-white:hover {
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
}

input[type="text"], textarea {
    background-color: #dcfce7; 
    border: 1px solid #bbf7d0;
    color: #065f46;
    border-radius: 0.75rem;
    padding: 0.5rem 0.75rem;
    width: 100%;
    box-sizing: border-box;
}
input[type="text"]:focus, textarea:focus {
    border-color: #22c55e;
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    outline: none;
}

button, #submit-report {
    background-color: #22c55e;
    color: #ffffff;
    font-weight: 600;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
}
button:hover, #submit-report:hover {
    background-color: #16a34a;
}

label {
    color: #065f46;
    font-weight: 500;
}

header, footer {
    background-color: rgba(34,197,94,0.85);
    color: #f0fdf4;
}
header h1, footer p, footer a {
    color: #f0fdf4;
}
header a:hover, footer a:hover {
    color: #bbf7d0;
}

#user-map-container {
    background-color: #bbf7d0;
    border-radius: 1.5rem;
    overflow: hidden;
    position: relative;
}

/* ‚úÖ Updated: ensure community feed images fit */
#feed-container img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
}

.chart-container {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    height: 300px;
    max-height: 400px;
}
@media (min-width: 768px) {
    .chart-container { height: 350px; }
}

.map-popup {
    background-color: #ffffff;
    border-radius: 1rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    padding: 0.75rem;
    color: #065f46;
    font-size: 0.875rem;
    pointer-events: none;
}

/* ‚úÖ Updated: map image fits properly */
#user-map-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.55;
    border-radius: 1rem;
}

footer {
    padding: 2rem 0;
    text-align: center;
}
footer p, footer a {
    color: #d1fae5;
}

.upload-container {
    border: 2px dashed #bbf7d0;
    border-radius: 0.75rem;
    padding: 1rem;
    background-color: rgba(220, 252, 231, 0.7);
    text-align: center;
    cursor: pointer;
}
.upload-container:hover {
    border-color: #22c55e;
}

input[type="checkbox"] {
    accent-color: #f87171; 
}

@media (min-width: 1024px) {
    .grid-cols-1.lg\:grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .lg\:col-span-2 {
        grid-column: span 2 / span 2;
    }
}
/* =========================
   REPLACEMENT CSS ‚Äî drop into <style> and replace your old CSS
   - Adds images to community feed cards (nth-child mapping)
   - Replaces map placeholder with provided map image
   - Keeps your theme / layout / responsiveness intact
   ========================= */

/* --- Base / layout / body --- */
:root{
  --brand-green: #22c55e;
  --brand-green-600: #16a34a;
  --text-dark: #065f46;
  --muted: #94a3b8;
}
* { box-sizing: border-box; }
html,body { height: 100%; margin: 0; padding: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color: var(--text-dark); }

/* Keep a pleasant page background (you can change the URL back to your image if desired) */
body {
  /* background: url('https://media.assettype.com/tnm/import/sites/all/var/www/images/SacredTrees-Photo-5.jpg?w=1280&auto=format,compress') no-repeat center center fixed;
  background-size: cover; */
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* light overlay so content is legible on the photo bg */
body::before{
  content: "";
  position: fixed;
  inset: 0;
  background-color: rgba(252,252,252,0.22);
  z-index: -1;
}

/* --- Header & tabs --- */
header, footer { background-color: rgba(34,197,94,0.85); color: #f0fdf4; }
header a, footer a { color: inherit; text-decoration: none; }
header a:hover, footer a:hover { color: #bbf7d0; }

.tab-btn { transition: all .18s ease; border-bottom-width: 2px; }
.tab-btn:hover { border-color: #4ade80; color: var(--brand-green-600); }
.tab-btn.active { border-color: var(--brand-green); color: var(--brand-green); }

/* --- Map pin / popup used by map view --- */
.map-pin {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid rgb(171,112,112);
  transform: translate(-50%,-50%);
  cursor: pointer;
  transition: transform .15s ease;
  z-index: 30;
}
.map-pin:hover { transform: translate(-50%,-50%) scale(1.4); }

.map-popup {
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  padding: 0.75rem;
  color: var(--text-dark);
  font-size: .9rem;
  pointer-events: none;
  z-index: 60;
}

/* --- Re-usable surface style (similar to your original .bg-white) --- */
.surface {
  background-color: #ffffff;
  border-radius: 1rem;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  transition: box-shadow .25s ease, transform .18s ease;
}
.surface:hover { box-shadow: 0 12px 24px rgba(0,0,0,0.12); }

/* Keep your existing .bg-white utility but allow targeted overrides below */
.bg-white {
  background-color: #ffffff !important;
  border-radius: 1.5rem;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
}

/* Inputs / focus styles */
input[type="text"], textarea {
  background-color: #dcfce7;
  border: 1px solid #bbf7d0;
  color: var(--text-dark);
  border-radius: .75rem;
  padding: .5rem .75rem;
  width: 100%;
}
input[type="text"]:focus, textarea:focus {
  border-color: var(--brand-green);
  box-shadow: 0 0 0 4px rgba(34,197,94,0.12);
  outline: none;
}

/* Buttons */
button, #submit-report { background-color: var(--brand-green); color: #fff; font-weight: 600; border-radius: .75rem; padding: .75rem 1rem; transition: background-color .15s ease; }
button:hover, #submit-report:hover { background-color: var(--brand-green-600); }

/* Upload area */
.upload-container {
  border: 2px dashed #bbf7d0;
  border-radius: .75rem;
  padding: 1rem;
  background-color: rgba(220,252,231,0.7);
  text-align: center;
  cursor: pointer;
}
.upload-container:hover { border-color: var(--brand-green); }

/* small tweaks */
label { color: var(--text-dark); font-weight: 500; }
input[type="checkbox"] { accent-color: #f87171; }

/* --- FEED CARD IMAGE INJECTION (CSS-only) --- */
/* We use selectors that target direct children of #feed-container to avoid changing other .bg-white usages site-wide. */
/* Each feed card (created by your JS) is a top-level div inside #feed-container. We hide the internal <img> and set the card container background. */

/* Make feed card containers image-friendly */
#feed-container > div {
  position: relative;
  overflow: hidden;
  border-radius: 1rem;
  min-height: 260px;            /* keeps consistent card height */
  background-color: transparent !important;  /* override .bg-white background for feed cards */
}

/* Hide the generated <img> inside each card (we use the container background instead) */
#feed-container > div img {
  display: none !important;
}

/* White overlay panel at the bottom for text readability */
#feed-container > div > .p-4 {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 30;
  background: linear-gradient(180deg, rgba(255,255,255,0.94), rgba(255,255,255,0.98));
  padding: 1rem;
  border-bottom-left-radius: 1rem;
  border-bottom-right-radius: 1rem;
}

/* Gentle image overlay for subtle darkening so text is readable */
#feed-container > div::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 20;
  background: linear-gradient(180deg, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0.24) 100%);
  pointer-events: none;
}

/* Specific images per card (maps to your mockData order) */
/* 1. Pothole */
#feed-container > div:nth-child(1) {
  background-image: url("https://www.hindustantimes.com/ht-img/img/2023/12/04/550x309/Uttar-Pradesh-on-top-with-55-4--deaths--File-photo_1701719100896.jpg");
  background-size: cover;
  background-position: center;
}

/* 2. Streetlight */
#feed-container > div:nth-child(2) {
  background-image: url("https://filecenter.deltaww.com/products/images/202309210950481205001.JPG?w=350");
  background-size: cover;
  background-position: center;
}

/* 3. Garbage */
#feed-container > div:nth-child(3) {
  background-image: url("https://media.istockphoto.com/id/1697146194/photo/a-pile-of-garbage-in-indian-road.jpg?s=612x612&w=0&k=20&c=sERL5_ZVFENjwSrJAHYElx7ybyjVHJGMfcPoelLCc_g=");
  background-size: cover;
  background-position: center;
}

/* 4. Faded crosswalk */
#feed-container > div:nth-child(4) {
  background-image: url("https://img.freepik.com/premium-photo/cracked-asphalt-showing-through-faded-white-crosswalk-paint_661495-102183.jpg");
  background-size: cover;
  background-position: center;
}

/* 5. Broken bench */
#feed-container > div:nth-child(5) {
  background-image: url("https://live.staticflickr.com/6011/5927269997_e719c36df4_b.jpg");
  background-size: cover;
  background-position: center;
}

/* 6. Leaking hydrant */
#feed-container > div:nth-child(6) {
  background-image: url("https://mustsharenews.com/wp-content/uploads/2024/12/little-india-water-1.jpg");
  background-size: cover;
  background-position: center;
}

/* Make sure text remains readable on small screens */
@media (max-width: 640px) {
  #feed-container > div { min-height: 200px; }
  #feed-container > div > .p-4 { padding: .75rem; }
}

/* --- MAP IMAGE REPLACEMENT --- */
/* Replace the placeholder map image (the <img> inside #user-map-container) with the supplied image using the container background. */
#user-map-container {
  background-image: url("https://miro.medium.com/0*x4L4vCqPxkaaDrjQ.jpg");
  background-size: cover;
  background-position: center;
  border-radius: 1rem;
  overflow: hidden;
  position: relative;
}

/* hide the existing <img> overlay to avoid doublestacking */
#user-map-container img { display: none !important; }

/* ensure pins and popups still sit above the map */
#user-map-container .map-pin, #user-map-container .map-popup { z-index: 40; }

/* --- Leaderboard / My Issues / other surfaces --- */
/* Maintain your card look for other areas: adjust spacing */
#my-issues-list .bg-white, #leaderboard-list .bg-white, .surface { padding: 0; }

/* Keep chart container responsive (from original styles) */
.chart-container {
  position: relative;
  width: 100%;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  height: 300px;
  max-height: 400px;
}
@media (min-width: 768px) {
  .chart-container { height: 350px; }
}

/* Footer spacing */
footer { padding: 2rem 0; text-align: center; color: #d1fae5; }

/* Accessibility: focus outlines for keyboard users */
a:focus, button:focus, input:focus, textarea:focus { outline: 3px solid rgba(34,197,94,0.18); outline-offset: 2px; }

/* End of replacement CSS */


    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">


    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold text-orange-500">Citizen Dashboard</h1>
            <a href="index.html" class="text-slate-600 hover:text-orange-500">Logout</a>
        </nav>
        <div class="border-b border-slate-200">
            <div class="container mx-auto px-4 flex space-x-4">
                <button class="user-tab-btn tab-btn py-3 px-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:border-slate-300 hover:text-slate-700 active" data-tab="report-issue">Report Issue</button>
                <button class="user-tab-btn tab-btn py-3 px-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:border-slate-300 hover:text-slate-700" data-tab="community-feed">Community Feed</button>
                <button class="user-tab-btn tab-btn py-3 px-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:border-slate-300 hover:text-slate-700" data-tab="scoreboard">My Issues & Scoreboard</button>
                <button class="user-tab-btn tab-btn py-3 px-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:border-slate-300 hover:text-slate-700" data-tab="map-view">Map View</button>
            </div>
        </div>
    </header>


    <main class="container mx-auto p-4 md:p-6 flex-1">
        <section id="user-tab-report-issue" class="user-tab-content tab-content active">
            <div class="max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-1">Report a New Civic Issue</h2>
                <p class="text-slate-500 mb-6">Help improve your community by reporting problems. Please provide as much detail as possible.</p>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Upload Photo/Video</label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 border-dashed rounded-md">
                            <div class="space-y-1 text-center">
                                <div class="text-4xl text-slate-400">üèûÔ∏è</div>
                                <p class="text-sm text-slate-500">Drag & drop or <button id="upload-btn" class="font-medium text-orange-500 hover:text-orange-600">click to upload</button></p>
                                <input id="file-input" type="file" accept="image/*,video/*" class="hidden" />
                            </div>
                        </div>
                    </div>

                    <div>
                        <label for="issue-description" class="block text-sm font-medium text-slate-600">Description</label>
                        <textarea id="issue-description" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-orange-400 focus:border-orange-400" placeholder="e.g., Large pothole on the corner of Main St and 1st Ave."></textarea>
                    </div>

                    <div>
                        <label for="issue-location" class="block text-sm font-medium text-slate-600">Location</label>
                        <input type="text" id="issue-location" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-orange-400 focus:border-orange-400" placeholder="Use current location or enter address">
                    </div>

                    <div class="flex items-center">
                        <input id="emergency-tag" type="checkbox" class="h-4 w-4 text-orange-500 border-slate-300 rounded focus:ring-orange-400">
                        <label for="emergency-tag" class="ml-2 block text-sm text-red-600 font-medium">Tag as Emergency (Accident, Fire, etc.)</label>
                    </div>

                    <button id="submit-report" class="w-full bg-orange-400 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-500 transition">Submit Report</button>
                </div>
            </div>
        </section>

        <section id="user-tab-community-feed" class="user-tab-content tab-content">
            <h2 class="text-2xl font-bold mb-4">Local Community Feed</h2>
            <div id="feed-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="user-tab-scoreboard" class="user-tab-content tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-bold mb-4">My Reported Issues</h2>
                    <div id="my-issues-list" class="space-y-4"></div>
                </div>
                <div>
                    <h2 class="text-2xl font-bold mb-4">Community Leaderboard</h2>
                    <div id="leaderboard-list" class="bg-white p-4 rounded-xl shadow-lg"></div>
                </div>
            </div>
        </section>

        <section id="user-tab-map-view" class="user-tab-content tab-content">
            <h2 class="text-2xl font-bold mb-4">Issue Map</h2>
            <div class="bg-white p-4 rounded-xl shadow-lg">
                <p class="text-slate-500 mb-4">This is a simulated map showing reported issues in your area. Click a pin to see details.</p>
                <div id="user-map-container" class="relative w-full h-96 bg-slate-200 rounded-lg overflow-hidden">
                    <img src="https://placehold.co/1200x800/e2e8f0/64748b?text=City+Map+View" class="w-full h-full object-cover opacity-50" alt="city map placeholder">
                </div>
            </div>
        </section>
    </main>

    <script>
        const mockData = {
            issues: [
                { id: 1, user: 'CitizenJane', title: 'Large pothole on Elm Street', description: 'A danger to cyclists and cars.', votes: 15, status: 'Pending', category: 'Pothole', location: { x: 25, y: 40 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Pothole' },
                { id: 2, user: 'StreetSavior', title: 'Streetlight out at Oak & Pine', description: 'It has been out for 3 days now, very dark at night.', votes: 8, status: 'In Progress', category: 'Streetlight', location: { x: 50, y: 60 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Broken+Light' },
                { id: 3, user: 'GreenThumb', title: 'Overflowing garbage can in Central Park', description: 'The bins near the playground are full and attracting pests.', votes: 22, status: 'Pending', category: 'Garbage', location: { x: 70, y: 30 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Overflowing+Bin' },
                { id: 4, user: 'CommuterCarl', title: 'Faded crosswalk markings', description: 'The crosswalk at the busy intersection of 1st and Main is barely visible.', votes: 5, status: 'Completed', category: 'Other', location: { x: 10, y: 80 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Faded+Crosswalk' },
                { id: 5, user: 'Anonymous', title: 'Broken park bench', description: 'A bench near the pond is broken and has splinters.', votes: 3, status: 'Completed', category: 'Other', location: { x: 85, y: 55 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Broken+Bench' },
                { id: 6, user: 'WaterWatcher', title: 'Leaking fire hydrant', description: 'Water has been pooling for hours at corner of 5th and Maple.', votes: 18, status: 'In Progress', category: 'Other', location: { x: 35, y: 75 }, image: 'https://placehold.co/600x400/cccccc/64748b?text=Leaking+Hydrant' },
            ],
            leaderboard: [
                { rank: 1, user: 'StreetSavior', points: 1250, badge: 'üèÜ Neighborhood Champion' },
                { rank: 2, user: 'CitizenJane', points: 980, badge: 'ü•á Top Contributor' },
                { rank: 3, user: 'GreenThumb', points: 850, badge: 'ü•à' },
                { rank: 4, user: 'WaterWatcher', points: 620, badge: 'ü•â' },
                { rank: 5, user: 'You', points: 450, badge: ' ' },
            ],
        };

        const statusColor = { 'Pending': 'red', 'In Progress': 'yellow', 'Completed': 'green' };

        function showUserTab(tabKey) {
            document.querySelectorAll('.user-tab-content').forEach(c => c.classList.remove('active'));
            const id = `user-tab-${tabKey}`;
            const el = document.getElementById(id);
            if (el) el.classList.add('active');

            document.querySelectorAll('.user-tab-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.querySelector(`.user-tab-btn[data-tab="${tabKey}"]`);
            if (btn) btn.classList.add('active');

            if (tabKey === 'map-view') {
                renderUserMap();
            }
            if (tabKey === 'community-feed') {
                renderCommunityFeed();
            }
            if (tabKey === 'scoreboard') {
                renderMyIssues();
                renderLeaderboard();
            }
        }

        
        function createIssueCard(issue) {
            const color = statusColor[issue.status] || 'gray';
            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <img src="${issue.image}" alt="${escapeHtml(issue.title)}" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">${escapeHtml(issue.title)}</h3>
                        <p class="text-slate-600 text-sm mb-2">Reported by: ${escapeHtml(issue.user)}</p>
                        <p class="text-slate-500 text-sm mb-4">${escapeHtml(issue.description)}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-4 text-slate-600">
                                <button class="hover:text-orange-500" data-action="vote" data-id="${issue.id}">üîº Vote (${issue.votes})</button>
                                <button class="hover:text-orange-500" data-action="comment" data-id="${issue.id}">üí¨ Comment</button>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full bg-${color}-100 text-${color}-700">${issue.status}</span>
                        </div>
                    </div>
                </div>
            `;
        }


        function renderCommunityFeed() {
            const container = document.getElementById('feed-container');
            container.innerHTML = mockData.issues.map(createIssueCard).join('');
            container.querySelectorAll('[data-action="vote"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = Number(btn.dataset.id);
                    const issue = mockData.issues.find(i => i.id === id);
                    if (issue) { issue.votes += 1; renderCommunityFeed(); }
                });
            });
        }

        function renderMyIssues() {
            const container = document.getElementById('my-issues-list');
            const myIssues = mockData.issues.slice(0, 2); 
            if (myIssues.length === 0) {
                container.innerHTML = '<p class="text-slate-500">You haven\'t reported any issues yet.</p>';
                return;
            }
            container.innerHTML = myIssues.map(issue => {
                const color = statusColor[issue.status] || 'gray';
                return `
                    <div class="bg-white p-4 rounded-lg shadow flex items-center justify-between">
                        <div>
                            <p class="font-semibold">${escapeHtml(issue.title)}</p>
                            <p class="text-sm text-slate-500">${escapeHtml(issue.category)}</p>
                        </div>
                        <span class="text-sm font-bold px-3 py-1 rounded-full bg-${color}-100 text-${color}-700">${issue.status}</span>
                    </div>
                `;
            }).join('');
        }

        function renderLeaderboard() {
            const container = document.getElementById('leaderboard-list');
            container.innerHTML = `
                <ul class="space-y-3">
                    ${mockData.leaderboard.map(p => `
                        <li class="flex items-center justify-between p-2 rounded-md ${p.user === 'You' ? 'bg-orange-100' : ''}">
                            <div class="flex items-center">
                                <span class="font-bold text-slate-600 w-6">${p.rank}.</span>
                                <div>
                                   <p class="font-semibold text-slate-800">${escapeHtml(p.user)}</p>
                                   <p class="text-xs text-orange-600">${escapeHtml(p.badge)}</p>
                                </div>
                            </div>
                            <span class="font-bold text-slate-700">${p.points} pts</span>
                        </li>
                    `).join('')}
                </ul>
            `;
        }

        function renderMap(containerId, issues) {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.map-pin').forEach(p => p.remove());
            issues.forEach(issue => {
                const pin = document.createElement('div');
                const color = statusColor[issue.status] || 'gray';
                pin.className = `map-pin bg-${color}-500`;
                pin.style.left = `${issue.location.x}%`;
                pin.style.top = `${issue.location.y}%`;
                pin.title = `${issue.title} (${issue.status})`;
                pin.addEventListener('click', (e) => {
                    document.querySelectorAll('.map-popup').forEach(p => p.remove());
                    const popup = document.createElement('div');
                    popup.className = 'map-popup absolute bg-white p-3 rounded shadow-lg text-sm';
                    popup.style.left = `${issue.location.x}%`;
                    popup.style.top = `${issue.location.y + 3}%`;
                    popup.style.transform = 'translate(-50%, 0)';
                    popup.innerHTML = `<strong>${escapeHtml(issue.title)}</strong><div class="text-slate-600">${escapeHtml(issue.description)}</div>`;
                    container.appendChild(popup);
                    setTimeout(() => popup.remove(), 6000);
                });
                container.appendChild(pin);
            });
        }

        function renderUserMap() {
            renderMap('user-map-container', mockData.issues);
        }
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'upload-btn') {
                document.getElementById('file-input').click();
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'submit-report') {
                const title = document.getElementById('issue-description').value || 'New Issue';
                const location = document.getElementById('issue-location').value || 'Unknown';
                const newIssue = {
                    id: mockData.issues.length + 1,
                    user: 'You',
                    title: title.length > 60 ? title.slice(0, 57) + '...' : title,
                    description: `Location: ${location}`,
                    votes: 0,
                    status: 'Pending',
                    category: 'Other',
                    location: { x: Math.floor(Math.random() * 90) + 5, y: Math.floor(Math.random() * 80) + 5 },
                    image: 'https://placehold.co/600x400/cccccc/64748b?text=New+Issue'
                };
                mockData.issues.unshift(newIssue);
                document.getElementById('issue-description').value = '';
                document.getElementById('issue-location').value = '';
                alert('Report submitted (demo). It is added to the local feed.');
                renderCommunityFeed();
                renderMyIssues();
                renderUserMap();
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.user-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => showUserTab(btn.dataset.tab));
            });
            showUserTab('report-issue');

            renderCommunityFeed();
            renderMyIssues();
            renderLeaderboard();
            renderUserMap();
        });
    </script>
</body>
</html>
